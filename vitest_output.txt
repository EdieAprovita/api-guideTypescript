
 RUN  v3.2.4 /Users/EACM/Developer/api-guideTypescript

âœ… Test database connected
INVALID EMAIL REGISTRATION BODY: {
  "success": true,
  "data": {
    "_id": "699a753181f3e21c31ef2447",
    "username": "testuser_1771730225750",
    "email": "test_1771730225750@example.com",
    "role": "user",
    "photo": "https://res.cloudinary.com/dzqbzqgjm/image/upload/v1599098981/default-user_qjqjqz.png",
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2OTlhNzUzMTgxZjNlMjFjMzFlZjI0NDciLCJlbWFpbCI6InRlc3RfMTc3MTczMDIyNTc1MEBleGFtcGxlLmNvbSIsInJvbGUiOiJ1c2VyIiwiaWF0IjoxNzcxNzMwMjI1LCJqdGkiOiIyZDk3NTdjMC1mODgzLTQ2MGUtYTY3Zi0xYzQyZDc4YzAzYTYiLCJleHAiOjE3NzE3MzM4MjUsImF1ZCI6InZlZ2FuLWd1aWRlLWNsaWVudCIsImlzcyI6InZlZ2FuLWd1aWRlLWFwaSJ9.wRNJ5TBmGoO1-ZmC94VrRiWIPF7BGT0iocGkMAW7hN4",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2OTlhNzUzMTgxZjNlMjFjMzFlZjI0NDciLCJlbWFpbCI6InRlc3RfMTc3MTczMDIyNTc1MEBleGFtcGxlLmNvbSIsInJvbGUiOiJ1c2VyIiwiaWF0IjoxNzcxNzMwMjI1LCJqdGkiOiIyZDk3NTdjMC1mODgzLTQ2MGUtYTY3Zi0xYzQyZDc4YzAzYTYiLCJ0eXBlIjoicmVmcmVzaCIsImV4cCI6MTc3MjMzNTAyNSwiYXVkIjoidmVnYW4tZ3VpZGUtY2xpZW50IiwiaXNzIjoidmVnYW4tZ3VpZGUtYXBpIn0.-yEzUZx_H7Mn1B9TeAYXn0VfMAJqp-D-5HBMzcdifJw"
  }
}
loginUser controller error: HttpError: Invalid credentials
    at UserService.validateUserCredentials (/Users/EACM/Developer/api-guideTypescript/src/services/UserService.ts:74:19)
    at UserService.loginUser (/Users/EACM/Developer/api-guideTypescript/src/services/UserService.ts:184:20)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at /Users/EACM/Developer/api-guideTypescript/src/controllers/userControllers.ts:48:24 {
  statusCode: 401,
  errors: [ { message: 'Invalid credentials' } ]
}
loginUser controller error: HttpError: Invalid credentials
    at UserService.validateUserCredentials (/Users/EACM/Developer/api-guideTypescript/src/services/UserService.ts:74:19)
    at UserService.loginUser (/Users/EACM/Developer/api-guideTypescript/src/services/UserService.ts:184:20)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at /Users/EACM/Developer/api-guideTypescript/src/controllers/userControllers.ts:48:24 {
  statusCode: 401,
  errors: [ { message: 'Invalid credentials' } ]
}
Authentication middleware error: HttpError: Not authorized to access this route
    at protect (/Users/EACM/Developer/api-guideTypescript/src/middleware/authMiddleware.ts:115:19)
    at Layer.handle [as handle_request] (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/route.js:149:13)
    at /Users/EACM/Developer/api-guideTypescript/src/test/setup/integration-setup.ts:154:80
    at Layer.handle [as handle_request] (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/layer.js:95:5)
    at /Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/index.js:346:12) {
  statusCode: 401,
  errors: [ { message: 'Not authorized to access this route' } ]
}
Authentication middleware error: HttpError: Not authorized to access this route
    at protect (/Users/EACM/Developer/api-guideTypescript/src/middleware/authMiddleware.ts:115:19)
    at Layer.handle [as handle_request] (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/route.js:149:13)
    at /Users/EACM/Developer/api-guideTypescript/src/test/setup/integration-setup.ts:154:80
    at Layer.handle [as handle_request] (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/layer.js:95:5)
    at /Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/index.js:346:12) {
  statusCode: 401,
  errors: [ { message: 'Not authorized to access this route' } ]
}
Authentication middleware error: HttpError: Not authorized to access this route
    at protect (/Users/EACM/Developer/api-guideTypescript/src/middleware/authMiddleware.ts:115:19)
    at Layer.handle [as handle_request] (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/route.js:149:13)
    at /Users/EACM/Developer/api-guideTypescript/src/middleware/validation.ts:308:16
    at Layer.handle [as handle_request] (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/route.js:149:13)
    at /Users/EACM/Developer/api-guideTypescript/src/test/setup/integration-setup.ts:154:80
    at Layer.handle [as handle_request] (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/route.js:119:3) {
  statusCode: 401,
  errors: [ { message: 'Not authorized to access this route' } ]
}
Authentication middleware error: HttpError: Not authorized to access this route
    at protect (/Users/EACM/Developer/api-guideTypescript/src/middleware/authMiddleware.ts:115:19)
    at Layer.handle [as handle_request] (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/route.js:149:13)
    at /Users/EACM/Developer/api-guideTypescript/src/test/setup/integration-setup.ts:154:80
    at Layer.handle [as handle_request] (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/layer.js:95:5)
    at /Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/index.js:284:15
    at param (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/index.js:365:14) {
  statusCode: 401,
  errors: [ { message: 'Not authorized to access this route' } ]
}
Authentication middleware error: HttpError: Not authorized to access this route
    at protect (/Users/EACM/Developer/api-guideTypescript/src/middleware/authMiddleware.ts:115:19)
    at Layer.handle [as handle_request] (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/route.js:149:13)
    at /Users/EACM/Developer/api-guideTypescript/src/test/setup/integration-setup.ts:154:80
    at Layer.handle [as handle_request] (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/layer.js:95:5)
    at /Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/index.js:284:15
    at param (/Users/EACM/Developer/api-guideTypescript/node_modules/express/lib/router/index.js:365:14) {
  statusCode: 401,
  errors: [ { message: 'Not authorized to access this route' } ]
}
âœ… Test database disconnected
 â¯ |integration| src/test/integration/user.integration.test.ts (13 tests | 2 failed) 328ms
   âœ“ User API Integration Tests > POST /api/v1/users/register > should handle user registration request 39ms
   Ã— User API Integration Tests > POST /api/v1/users/register > should handle invalid email format 11ms
     â†’ expected 201 to be 400 // Object.is equality
   Ã— User API Integration Tests > POST /api/v1/users/register > should handle weak password 6ms
     â†’ expected 201 to be 400 // Object.is equality
   âœ“ User API Integration Tests > POST /api/v1/users/login > should handle login request 4ms
   âœ“ User API Integration Tests > POST /api/v1/users/login > should handle invalid credentials 4ms
   âœ“ User API Integration Tests > Protected Endpoints > should handle GET /api/v1/users without auth 4ms
   âœ“ User API Integration Tests > Protected Endpoints > should handle GET /api/v1/users/profile without auth 3ms
   âœ“ User API Integration Tests > Protected Endpoints > should handle PUT /api/v1/users/profile without auth 4ms
   âœ“ User API Integration Tests > Protected Endpoints > should handle PATCH /api/v1/users/profile/:id/role without auth 4ms
   âœ“ User API Integration Tests > Protected Endpoints > should handle PATCH /api/v1/users/profile/:id/role invalid role validation 4ms
   âœ“ User API Integration Tests > Protected Endpoints > should handle PATCH /api/v1/users/profile/:id/role when role is missing 3ms
   âœ“ User API Integration Tests > Protected Endpoints > should handle PATCH /api/v1/users/profile/:id/role with valid admin token 4ms
   âœ“ User API Integration Tests > Protected Endpoints > should handle DELETE /api/v1/users/:id without auth 3ms

â¯â¯â¯â¯â¯â¯â¯ Failed Tests 2 â¯â¯â¯â¯â¯â¯â¯

 FAIL  |integration| src/test/integration/user.integration.test.ts > User API Integration Tests > POST /api/v1/users/register > should handle invalid email format
AssertionError: expected 201 to be 400 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 201[39m

 â¯ src/test/integration/user.integration.test.ts:61:37
     59|             }
     60| 
     61|             expect(response.status).toBe(400);
       |                                     ^
     62|         });
     63| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/2]â¯

 FAIL  |integration| src/test/integration/user.integration.test.ts > User API Integration Tests > POST /api/v1/users/register > should handle weak password
AssertionError: expected 201 to be 400 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 201[39m

 â¯ src/test/integration/user.integration.test.ts:69:37
     67|             const response: Response = await request(app).post('/api/vâ€¦
     68| 
     69|             expect(response.status).toBe(400);
       |                                     ^
     70|         });
     71|     });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/2]â¯


 Test Files  1 failed (1)
      Tests  2 failed | 11 passed (13)
   Start at  21:17:04
   Duration  1.38s (transform 179ms, setup 222ms, collect 730ms, tests 328ms, environment 0ms, prepare 26ms)

